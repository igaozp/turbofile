# imFile 项目架构概览

## 简介

imFile 是一个基于 Electron 的全功能下载管理器，支持 HTTP、FTP、BitTorrent 和 Magnet 下载。它是 Motrix 的分支版本，使用 Vue.js + Element UI 构建前端界面，Aria2 作为下载引擎。

## 技术栈

### 核心技术
- **Electron** - 跨平台桌面应用框架
- **Vue.js 2.7** - 前端框架
- **Vuex** - 状态管理
- **Vue Router** - 路由管理
- **Element UI** - UI 组件库
- **Aria2** - 下载引擎

### 构建工具
- **Webpack** - 模块打包工具
- **Babel** - JavaScript 编译器
- **ESLint** - 代码检查工具
- **SCSS/Tailwind CSS** - 样式预处理

## 项目结构

```
src/
├── main/           # Electron 主进程代码
├── renderer/       # Electron 渲染进程代码（前端）
└── shared/         # 主进程和渲染进程共享代码
```

### 主要目录详解

#### `src/main/` - 主进程
```
main/
├── Application.js          # 应用程序主类
├── Launcher.js            # 启动器
├── core/                  # 核心功能模块
│   ├── Engine.js          # Aria2 引擎管理
│   ├── EngineClient.js    # Aria2 客户端通信
│   ├── ConfigManager.js   # 配置管理
│   ├── UpdateManager.js   # 自动更新管理
│   └── ...               # 其他核心模块
├── ui/                    # UI 管理模块
│   ├── WindowManager.js   # 窗口管理
│   ├── MenuManager.js     # 菜单管理
│   ├── TrayManager.js     # 系统托盘管理
│   └── ...               # 其他 UI 管理模块
└── utils/                 # 工具函数
```

#### `src/renderer/` - 渲染进程
```
renderer/
├── api/                   # API 通信层
├── components/            # Vue 组件
│   ├── Task/             # 任务相关组件
│   ├── Preference/       # 设置页面组件
│   ├── TaskDetail/       # 任务详情组件
│   └── ...              # 其他功能组件
├── store/                # Vuex 状态管理
│   └── modules/          # 状态模块
│       ├── app.js        # 应用状态
│       ├── task.js       # 任务状态
│       └── preference.js  # 设置状态
├── router/               # 路由配置
└── pages/                # 页面入口
```

#### `src/shared/` - 共享代码
```
shared/
├── aria2/                # Aria2 客户端实现
│   └── lib/              # JSON-RPC 客户端
├── constants.js          # 常量定义
├── locales/              # 国际化文件
└── utils/                # 共享工具函数
```

## 架构特点

### 1. Electron 双进程架构
- **主进程 (Main Process)**: 管理应用生命周期、创建窗口、处理系统级操作
- **渲染进程 (Renderer Process)**: 运行 Web 页面，处理用户界面

### 2. 模块化设计
- 主进程采用管理器模式，每个功能模块独立管理
- 渲染进程使用 Vue.js 组件化开发
- 共享代码实现代码复用

### 3. 事件驱动通信
- 主进程和渲染进程通过 IPC (Inter-Process Communication) 通信
- 使用事件发布/订阅模式处理异步操作

### 4. 外部引擎集成
- Aria2 作为独立进程运行
- 通过 JSON-RPC 协议与 Aria2 通信
- 支持 WebSocket 和 HTTP 两种通信方式

## 核心功能模块

### 1. 下载引擎
- Aria2 进程管理
- 多协议支持 (HTTP/HTTPS/FTP/BitTorrent/Magnet)
- 断点续传
- 多线程下载

### 2. 任务管理
- 任务创建、暂停、恢复、删除
- 任务状态监控
- 队列管理
- 下载历史

### 3. 用户界面
- 现代化设计
- 深色/浅色主题
- 多语言支持
- 响应式布局

### 4. 系统集成
- 系统托盘
- 桌面通知
- 文件关联
- 自动启动

## 数据流向

```
用户操作 → 渲染进程 → IPC → 主进程 → Aria2 引擎
                ↓         ↓
             Vuex Store  配置文件
```

1. 用户在界面上操作
2. 渲染进程处理用户输入，更新 Vuex 状态
3. 通过 IPC 将请求发送到主进程
4. 主进程调用相应的管理器处理请求
5. 与 Aria2 引擎通信执行下载操作
6. 结果通过 IPC 返回到渲染进程更新界面

这种架构确保了应用的稳定性、可维护性和良好的用户体验。